# Project Structure for /home/runner/work/SwatStockConsole/SwatStockConsole

- **.asciidoctor/**
  - **diagram/**
    - plantuml.jar (11565517 bytes)
- **.git/**
- **.github/**
  - **workflows/**
    - buildpipeline.yml (958 bytes)
      - Content preview:
```
name: BuildPipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.x
      - name: Restore dependencies
        run: dotnet restore
      - name: Build
        run: dotnet build --no-restore
        env:
          ALPHA_API_KEY: ${{ secrets.ALPHA_API_KEY }}
          ALPHA_API_URL: ${{ secrets.ALPHA_API_URL }}
      - name: Test
        run: dotnet test --no-build --verbosity normal --logger "trx;LogFileName=test-results.trx" --results-directory ./TestResults --filter "TestCategory=ContinuousIntegration"
          
      - name: TestReport
        uses: dorny/test-reporter@v2
        if: success() || failure()
        with:
          name: .NET Tests
          path: ./TestResults/*.trx
          reporter: dotnet-trx
```
    - c4-documentation-with-deepseek.yml (17523 bytes)
      - Content preview:
```
name: C4 Documentation Generator with DeepSeek

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  generate-c4-docs:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for proper analysis

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Setup GraphViz (for PlantUML)
        run: sudo apt-get update && sudo apt-get install -y graphviz

      - name: Install AsciiDoctor and PlantUML dependencies
        run: |
          sudo apt-get install -y ruby
          sudo gem install asciidoctor
          sudo gem install asciidoctor-diagram
          mkdir -p .asciidoctor/diagram
          wget https://github.com/plantuml/plantuml/releases/download/v1.2023.10/plantuml-1.2023.10.jar -O .asciidoctor/diagram/plantuml.jar

      - name: Install code-context-llm
        run: npm install -g code-context-llm
        
      - name: Generate code context for LLM
        run: |
          npx code-context-llm --project-path . --output-file MyProjectStructure.md --skip-dirs dist,build --skip-files .env 
          echo "Code context generated"

      - name: Convert Markdown to JSON for DeepSeek API
        run: |
          cat > markdown-to-json.js <<'EOF'
          const fs = require('fs');

          try {
            // Read the Markdown file generated by code-context-llm
            const markdownContent = fs.readFileSync('MyProjectStructure.md', 'utf8');

            // Create a simple structure to represent code context
            const codeContext = {
              projectName: "SwatStockConsole",
              files: [],
              description: "A console application for retrieving and displaying stock data"
            };

            // Parse the Markdown to extract file information
            const lines = markdownContent.split('\n');
            let currentFile = null;
            let collectingCode = false;

            for (let i = 0; i < lines.length; i++) {
              const line = lines[i];

              // Detect file sections
              if (line.includes('.cs (') && line.trim().endsWith('bytes)')) {
                // Extract filename from line like "    - DailyPriceData.cs (215 bytes)"
                const match = line.match(/\s*-\s*([\w\/\.]+\.cs)\s*\((\d+) bytes\)/);
                if (match) {
                  const [_, fileName, size] = match;
                  currentFile = {
                    path: fileName,
                    size: parseInt(size),
                    content: "",
                    previewFound: false
                  };
                  codeContext.files.push(currentFile);
                }
              }

              // Look for content preview
              if (currentFile && line.trim() === "Content preview:") {
                collectingCode = true;
                currentFile.previewFound = true;
                i++; // Skip the "` ` `" line
                continue;
              }

              // Collect code content from preview section
              if (collectingCode && currentFile && currentFile.previewFound) {
                if (line === "` ` `") {
                  collectingCode = false;
                } else {
                  currentFile.content += line + "\n";
                }
              }
            }

            // Write converted data to JSON file
            fs.writeFileSync('code-context.json', JSON.stringify(codeContext, null, 2));
            console.log("Successfully converted Markdown to JSON");

          } catch (error) {
            console.error("Error processing Markdown file:", error);
            process.exit(1);
          }
          EOF

          # Run the conversion script
          node markdown-to-json.js

      - name: Create C4 diagrams directory
        run: mkdir -p docs/c4/diagrams

      - name: Generate C4 models using DeepSeek API
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: |
          cat > generate-c4-diagrams.js <<'EOF'
          const fs = require('fs');
          const path = require('path');
          const https = require('https');
          
          // Read the code context
          const codeContext = JSON.parse(fs.readFileSync('code-context.json', 'utf8'));
          
          // Function to call DeepSeek API
          async function callDeepSeekAPI(prompt, outputFile, diagramType) {
            return new Promise((resolve, reject) => {
              const apiKey = process.env.DEEPSEEK_API_KEY;
          
              if (!apiKey) {
                reject(new Error('DEEPSEEK_API_KEY is not set'));
                return;
              }
          
              const data = JSON.stringify({
                model: "deepseek-reasoner",
                messages: [
                  {
                    role: "system", 
                    content: "You are an expert software architect who specializes in creating C4 model diagrams using PlantUML syntax. Analyze the provided code context and generate accurate, well-structured diagrams that follow C4 model conventions."
                  },
                  { role: "user", content: prompt }
                ],
                temperature: 0.1,
                max_tokens: 4096
              });
          
              const options = {
                hostname: 'api.deepseek.com',
                path: '/chat/completions',
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${apiKey}`,
                  'Content-Length': data.length
                }
              };
          
              const req = https.request(options, (res) => {
                let responseData = '';
          
                res.on('data', (chunk) => {
                  responseData += chunk;
                });
          
                res.on('end', () => {
                  try {
                    const parsedResponse = JSON.parse(responseData);
                    if (parsedResponse.error) {
                      reject(new Error(`API error: ${parsedResponse.error.message}`));
                      return;
                    }
          
                    const plantUmlContent = extractPlantUMLFromResponse(parsedResponse.choices[0].message.content);
          
                    // Save the PlantUML content to the specified file
                    fs.writeFileSync(outputFile, plantUmlContent);
                    console.log(`Generated ${diagramType} diagram: ${outputFile}`);
          
                    resolve(plantUmlContent);
                  } catch (error) {
                    reject(new Error(`Failed to parse API response: ${error.message}`));
                  }
                });
              });
          
              req.on('error', (error) => {
                reject(new Error(`API request failed: ${error.message}`));
              });
          
              req.write(data);
              req.end();
            });
          }
          
          // Function to extract PlantUML code from the response
          function extractPlantUMLFromResponse(response) {
            // Look for PlantUML code between @startuml and @enduml tags
            const match = response.match(/@startuml[\s\S]*?@enduml/);
            if (match) {
              return match[0];
            }
          
            // If no explicit tags, look for PlantUML-like content
            const lines = response.split('\n');
            let inCodeBlock = false;
            let plantUmlContent = [];
            let foundPlantUml = false;
          
            for (const line of lines) {
              if (line.trim().startsWith('` ` `plantuml') || line.trim().startsWith('` ` `puml')) {
                inCodeBlock = true;
                foundPlantUml = true;
                plantUmlContent.push('@startuml');
                continue;
              }
          
              if (inCodeBlock && line.trim() === '` ` `') {
                inCodeBlock = false;
                plantUmlContent.push('@enduml');
                continue;
              }
          
              if (inCodeBlock) {
                plantUmlContent.push(line);
              }
            }
          
            if (foundPlantUml) {
              return plantUmlContent.join('\n');
            }
          
            // If still no PlantUML content found, wrap the entire response
            console.log("No PlantUML markers found, using response as raw content");
            return `@startuml\n${response}\n@enduml`;
          }
          
          // Generate context prompt from code context
          function generateContextPrompt(diagramType) {
            let prompt = `Based on the following code context, generate a C4 ${diagramType} diagram using PlantUML syntax.\n\n`;
            prompt += `Code context:\n${JSON.stringify(codeContext, null, 2)}\n\n`;
          
            switch (diagramType) {
              case 'Context':
                prompt += "Create a System Context diagram showing the SwatStockConsole application, its users, and external dependencies like the Alpha Vantage API. Focus on high-level relationships between systems.";
                break;
              case 'Container':
                prompt += "Create a Container diagram showing the main components within the SwatStockConsole application. Include the API service, chart service, models, utilities, and console application containers and how they interact.";
                break;
              case 'Component':
                prompt += "Create a Component diagram detailing the internal components of the SwatStockConsole application, showing interfaces, implementations, and their relationships.";
                break;
              case 'Code':
                prompt += "Create a detailed Code diagram showing key classes, interfaces, and their relationships within the SwatStockConsole application.";
                break;
            }
          
            prompt += "\n\nUse the C4-PlantUML syntax and ensure your diagram follows C4 model best practices. Return only the PlantUML code without explanations.";
          
            return prompt;
          }
          
          // Main execution
          async function generateAllDiagrams() {
            try {
              // Define the diagrams to generate
              const diagrams = [
                { type: 'Context', file: 'docs/c4/diagrams/c4_context.puml' },
                { type: 'Container', file: 'docs/c4/diagrams/c4_container.puml' },
                { type: 'Component', file: 'docs/c4/diagrams/c4_component.puml' }
              ];
          
              for (const diagram of diagrams) {
                const prompt = generateContextPrompt(diagram.type);
                await callDeepSeekAPI(prompt, diagram.file, diagram.type);
              }
          
              // Generate the AsciiDoc file
              generateAsciiDoc();
          
              console.log('All diagrams generated successfully');
            } catch (error) {
              console.error('Error generating diagrams:', error);
              process.exit(1);
            }
          }
          
          function generateAsciiDoc() {
            // Build AsciiDoc content using string concatenation to avoid YAML parsing issues
            let asciidocContent = "";
            asciidocContent += "= SwatStockConsole C4 Architecture Documentation\n\n";
            asciidocContent += ":toc: left\n";
            asciidocContent += ":toclevels: 3\n";
            asciidocContent += ":sectnums:\n";
            asciidocContent += ":plantuml-format: svg\n\n";
          
            asciidocContent += "== Introduction\n\n";
            asciidocContent += "This document provides the C4 model architecture documentation for the SwatStockConsole application.\n";
            asciidocContent += "The diagrams are automatically generated based on code analysis using DeepSeek AI.\n\n";
          
            asciidocContent += "== C4 Model\n\n";
            asciidocContent += "The C4 model is a simple way to document software architecture using four levels:\n\n";
            asciidocContent += "1. System Context: People and software systems\n";
            asciidocContent += "2. Containers: Applications and data stores\n";
            asciidocContent += "3. Components: Groups of related functionality\n";
            asciidocContent += "4. Code: Classes, interfaces, etc.\n\n";
          
            asciidocContent += "=== System Context Diagram\n\n";
            asciidocContent += "The System Context diagram shows the SwatStockConsole system in context with its users and external dependencies.\n\n";
            asciidocContent += "[plantuml, \"c4-context-diagram\", svg]\n";
            asciidocContent += "....\n";
            asciidocContent += "include::diagrams/c4_context.puml[]\n";
            asciidocContent += "....\n\n";
          
            asciidocContent += "=== Container Diagram\n\n";
            asciidocContent += "The Container diagram shows the major components within the SwatStockConsole system.\n\n";
            asciidocContent += "[plantuml, \"c4-container-diagram\", svg]\n";
            asciidocContent += "....\n";
            asciidocContent += "include::diagrams/c4_container.puml[]\n";
            asciidocContent += "....\n\n";
          
            asciidocContent += "=== Component Diagram\n\n";
            asciidocContent += "The Component diagram shows the internal components of the SwatStockConsole application.\n\n";
            asciidocContent += "[plantuml, \"c4-component-diagram\", svg]\n";
            asciidocContent += "....\n";
            asciidocContent += "include::diagrams/c4_component.puml[]\n";
            asciidocContent += "....\n\n";
          
            asciidocContent += "== Implementation Details\n\n";
            asciidocContent += "The SwatStockConsole application is a .NET console application that retrieves stock data from Alpha Vantage API\n";
            asciidocContent += "and displays it as candlestick charts in the console.\n\n";
          
            asciidocContent += "=== Key Components\n\n";
            asciidocContent += "- AlphaVantageApiService: Handles communication with the Alpha Vantage API\n";
            asciidocContent += "- ChartService: Renders ASCII-based candlestick charts\n";
            asciidocContent += "- JsonUtility: Parses JSON responses from the API\n";
            asciidocContent += "- Client: Orchestrates the application flow\n";
            asciidocContent += "- DailyPriceData: Data model for daily stock price information\n\n";
          
            asciidocContent += "== Maintenance\n\n";
            asciidocContent += "This documentation is automatically generated from the codebase and updated on every commit.\n";
            asciidocContent += "The diagrams are created using DeepSeek AI to analyze the code structure.\n\n";
          
            asciidocContent += "Last generated: " + new Date().toISOString();
          
            fs.writeFileSync('docs/c4/c4_documentation.adoc', asciidocContent);
            console.log('AsciiDoc file generated: docs/c4/c4_documentation.adoc');
          }
          
          // Start generation
          generateAllDiagrams();
          EOF

      
      - name: Generate HTML documentation
        run: |
          asciidoctor -r asciidoctor-diagram -D docs/c4/html docs/c4/c4_documentation.adoc
          echo "HTML documentation generated"

      - name: Create branch for documentation update
        id: create-branch
        run: |
          BRANCH_NAME="docs/c4-update-$(date +%Y%m%d%H%M%S)"
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git checkout -b $BRANCH_NAME
          echo "branch_name=$BRANCH_NAME" >> $GITHUB_OUTPUT

      - name: Commit documentation changes
        id: commit
        run: |
          git add docs/c4/
          # Only commit if there are changes
          if git diff --staged --quiet; then
            echo "No changes to commit"
            echo "has_changes=false" >> $GITHUB_OUTPUT
          else
            git commit -m "Update C4 documentation [skip ci]"
            echo "has_changes=true" >> $GITHUB_OUTPUT
          fi

      - name: Push changes
        if: steps.commit.outputs.has_changes == 'true'
        run: git push origin ${{ steps.create-branch.outputs.branch_name }}

      - name: Create Pull Request
        if: steps.commit.outputs.has_changes == 'true'
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.create-branch.outputs.branch_name }}
          base: main
          title: "Update C4 documentation"
          body: |
            This PR updates the C4 architecture documentation based on recent code changes.
            
            The documentation was automatically generated using DeepSeek AI to analyze the codebase structure.
            
            ## Changes
            - Updated System Context diagram
            - Updated Container diagram
            - Updated Component diagram
            - Generated AsciiDoc and HTML documentation
          labels: "documentation,automated"
```
    - codecoverage.yml (1641 bytes)
      - Content preview:
```
name: CodeCoverage

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
permissions:
  contents: read
  actions: read
  checks: write

jobs:
  build-test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.x
          
      - name: Restore dependencies
        run: dotnet restore
        
      - name: Build
        run: dotnet build --no-restore
        env:
          ALPHA_API_KEY: ${{ secrets.ALPHA_API_KEY }}
          ALPHA_API_URL: ${{ secrets.ALPHA_API_URL }}
          
      - name: Test with coverage
        run: dotnet test --no-build --verbosity normal --filter "TestCategory=ContinuousIntegration" /p:CollectCoverage=true /p:CoverletOutputFormat=opencover
          
      - name: Generate coverage report
        uses: danielpalme/ReportGenerator-GitHub-Action@5.4.4
        with:
          reports: '**/coverage.opencover.xml'
          targetdir: 'coveragereport'
          reporttypes: 'HtmlInline;Cobertura'

      - name: Upload coverage report artifact
        uses: actions/upload-artifact@v4.6.2
        with:
          name: CoverageReport
          path: coveragereport

      - name: Create Coverage Badge
        uses: simon-k/dotnet-code-coverage-badge@v1.0.0
        id: coverage-badge
        with:
          label: Coverage
          color: brightgreen
          path: './TestStockConsole/coverage.opencover.xml'
          gist-filename: code-coverage.json
          gist-id: ${{ secrets.GIST_ID }}
          gist-auth-token: ${{ secrets.GIST_TOKEN }}
```
  - dependabot.yml (467 bytes)
    - Content preview:
```
# To get started with Dependabot version updates, you'll need to specify which
# package ecosystems to update and where the package manifests are located.
# Please see the documentation for all configuration options:
# https://docs.github.com/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file
version: 2
updates:
  - package-ecosystem: "nuget"
    directory: "/StockConsole" 
    schedule:
      interval: "weekly"

```
- **docs/**
  - **c4/**
    - c4_documentation.adoc 
- **Images/**
  - TestSummary.png (98257 bytes)
- **StockConsole/**
  - **Model/**
    - DailyPriceData.cs (215 bytes)
      - Content preview:
```
namespace StockConsole.Model;

public record DailyPriceData
{
    public decimal Open { get; set; }
    public decimal High { get; set; }
    public decimal Low { get; set; }
    public decimal Close { get; set; }
}
```
  - **Services/**
    - AlphaVantageApiService.cs (1364 bytes)
      - Content preview:
```
using Microsoft.Extensions.Configuration;
using StockConsole.Model;
using StockConsole.Utility;

namespace StockConsole.Services;

public class AlphaVantageApiService(IHttpClientFactory clientFactory, IConfiguration configuration)
    : IAlphaVantageApiService
{
    private readonly string _apiKey = configuration["ALPHA_API_KEY"] ?? throw new ArgumentException("Api Key not found");
    private readonly string _apiUrl = configuration["ALPHA_API_URL"] ?? throw new ArgumentException("Api url not found");

    public async Task<decimal> GetMostRecentPrice(string symbol)
    {
        var json = await FetchApi(_apiUrl,"GLOBAL_QUOTE", _apiKey, symbol);
        return JsonUtility.ExtractLatestPrice(json);
    }
    
    public async Task<List<DailyPriceData>> GetTimeSeries(string symbol, int days)
    {
        var json = await FetchApi(_apiUrl,"TIME_SERIES_DAILY", _apiKey, symbol);
        return JsonUtility.ExtractAllPricesLastXDays(json,days);
    }

    private async Task<string> FetchApi(string url, string function, string apiKey, string symbol)
    {
        var requestUrl = url
            .Replace("{function}", function)
            .Replace("{symbol}", symbol)
            .Replace("{apiKey}", apiKey);
            
        var client = clientFactory.CreateClient("AlphaVantage");
        return await client.GetStringAsync(requestUrl);
    }
}
```
    - ChartService.cs (4458 bytes)
      - Content preview:
```
using System.Text;
using StockConsole.Model;

namespace StockConsole.Services;


/// <summary>
/// This Code was generated by Claude.ai
/// </summary>
public class ChartService : IChartService
{
    private const int ChartHeight = 15;
    private const char UpBodyChar = '█';    // Full block for up days
    private const char DownBodyChar = '░';  // Light shade for down days - better distinction
    private const char WickChar = '│';      // Box drawings light vertical
    private const char AxisChar = '│';
    private const char HorizontalLineChar = '─';
    
    public string RenderCandlestickChart(List<DailyPriceData> timeSeries)
    {
        var sb = new StringBuilder();
        
        decimal minPrice = timeSeries.Min(d => d.Low);
        decimal maxPrice = timeSeries.Max(d => d.High);
        decimal priceRange = maxPrice - minPrice;
        
        decimal padding = priceRange * 0.1m;
        minPrice -= padding;
        maxPrice += padding;
        priceRange = maxPrice - minPrice;
        
        if (priceRange == 0)
            priceRange = 1;
        
        sb.AppendLine($"Candlestick Chart (Last {timeSeries.Count} days)");
        sb.AppendLine(new string('-', timeSeries.Count * 2 + 15));
        
        sb.AppendLine($"{maxPrice:F2} {AxisChar}");
        
        DrawCandles(timeSeries, maxPrice, priceRange, sb);
        
        // Add bottom price scale
        sb.Append($"{minPrice:F2} {AxisChar}");
        sb.AppendLine(new string(HorizontalLineChar, timeSeries.Count * 2));
        
        // Add day markers at bottom with better spacing
        sb.Append("       ");
        for (int i = 0; i < timeSeries.Count; i++)
        {
            if (i < 9)
                sb.Append($"{i+1} ");
            else
                sb.Append($"{i+1}");
            
            if (i < timeSeries.Count - 1 && i >= 9)
                sb.Append(" ");
        }
        
        // Add legend
        sb.AppendLine();
        sb.AppendLine();
        sb.AppendLine($"Legend: {UpBodyChar} Up day   {DownBodyChar} Down day   {WickChar} Price range/wick");
        
        return sb.ToString();
    }

    private static void DrawCandles(List<DailyPriceData> timeSeries, decimal maxPrice, decimal priceRange, StringBuilder sb)
    {
        for (int row = 0; row < ChartHeight; row++)
        {
            // Calculate the price level for this row
            decimal rowPrice = maxPrice - (row * priceRange / ChartHeight);
            
            // Start with price label and axis
            sb.Append($"{rowPrice:F2} {AxisChar}");
            
            // Draw candles in each column
            for (int i = 0; i < timeSeries.Count; i++)
            {
                var data = timeSeries[i];
                var isUpDay = data.Close >= data.Open;
                
                // Calculate normalized positions (0 to ChartHeight-1)
                int highPos = NormalizePrice(data.High, maxPrice, priceRange);
                int lowPos = NormalizePrice(data.Low, maxPrice, priceRange);
                int openPos = NormalizePrice(data.Open, maxPrice, priceRange);
                int closePos = NormalizePrice(data.Close, maxPrice, priceRange);
                
                // Current row position (0 at top, ChartHeight-1 at bottom)
                int currentPos = row;
                
                // Determine what to draw at this position
                var charToDraw = CharToDraw(currentPos, highPos, lowPos, openPos, closePos, isUpDay);

                // Add a space after each character to improve spacing in terminals
                sb.Append(charToDraw + " ");
            }
            
            sb.AppendLine();
        }
    }

    private static char CharToDraw(int currentPos, int highPos, int lowPos, int openPos, int closePos, bool isUpDay)
    {
        char charToDraw = ' ';

        if (currentPos >= highPos && currentPos <= lowPos)
        {
            if (currentPos >= Math.Min(openPos, closePos) && currentPos <= Math.Max(openPos, closePos))
            {
                charToDraw = isUpDay ? UpBodyChar : DownBodyChar;
            }
            else
            {
                charToDraw = WickChar;
            }
        }

        return charToDraw;
    }

    private static int NormalizePrice(decimal price, decimal maxPrice, decimal priceRange)
    {
        return (int)Math.Round((maxPrice - price) / priceRange * ChartHeight);
    }
}
```
    - IAlphaVantageApiService.cs (589 bytes)
      - Content preview:
```
using StockConsole.Model;

namespace StockConsole.Services;

public interface IAlphaVantageApiService
{
    /// <summary>
    /// Returns the most recent price available.
    /// </summary>
    /// <param name="symbol"></param>
    /// <returns></returns>
    public Task<decimal> GetMostRecentPrice(string symbol);
    
    /// <summary>
    /// Gets the Time Series for the daily Price.
    /// </summary>
    /// <param name="symbol"></param>
    /// <param name="days"></param>
    /// <returns></returns>
    public Task<List<DailyPriceData>> GetTimeSeries(string symbol, int days);
}
```
    - IChartService.cs (322 bytes)
      - Content preview:
```
using StockConsole.Model;

namespace StockConsole.Services;

public interface IChartService
{
    
    /// <summary>
    /// Renders the CandleStick chart visible.
    /// </summary>
    /// <param name="timeSeries"></param>
    /// <returns></returns>
    string RenderCandlestickChart(List<DailyPriceData> timeSeries);
}
```
  - **Utility/**
    - JsonUtility.cs (2448 bytes)
      - Content preview:
```
using System.Text.Json;
using StockConsole.Model;

namespace StockConsole.Utility;

public static class JsonUtility
{
    public static decimal ExtractLatestPrice(string json)
    {
        using JsonDocument document = JsonDocument.Parse(json);

        if (!document.RootElement.TryGetProperty("Global Quote", out JsonElement globalQuote))
            throw new JsonException("Global Quote property not found in API response");

        if (!globalQuote.TryGetProperty("05. price", out JsonElement priceProperty))
            throw new JsonException("Price property not found in API response");

        var priceString = priceProperty.GetString()!;
        return decimal.Parse(priceString);
    }

    public static List<DailyPriceData> ExtractAllPricesLastXDays(string json, int numberOfDays)
    {
        var result = new List<DailyPriceData>();
        using JsonDocument document = JsonDocument.Parse(json);

        document.RootElement.TryGetProperty("Time Series (Daily)", out var timeSeriesDaily);

        var dates = timeSeriesDaily.EnumerateObject()
            .Select(p => p.Name)
            .OrderByDescending(date => date)
            .Take(numberOfDays);

        foreach (var date in dates)
        {
            if (timeSeriesDaily.TryGetProperty(date, out var dailyData))
            {
                var priceData = new DailyPriceData();

                if (dailyData.TryGetProperty("1. open", out var openElement) &&
                    decimal.TryParse(openElement.GetString(), out var openPrice))
                {
                    priceData.Open = openPrice;
                }

                if (dailyData.TryGetProperty("2. high", out var highElement) &&
                    decimal.TryParse(highElement.GetString(), out var highPrice))
                {
                    priceData.High = highPrice;
                }

                if (dailyData.TryGetProperty("3. low", out var lowElement) &&
                    decimal.TryParse(lowElement.GetString(), out var lowPrice))
                {
                    priceData.Low = lowPrice;
                }

                if (dailyData.TryGetProperty("4. close", out var closeElement) &&
                    decimal.TryParse(closeElement.GetString(), out var closePrice))
                {
                    priceData.Close = closePrice;
                }

                result.Add(priceData);
            }
        }

        return result;
    }
}
```
  - Client.cs (1135 bytes)
    - Content preview:
```
using Microsoft.Extensions.DependencyInjection;
using StockConsole.Services;

namespace StockConsole;

public static class Client
{
    public static void StartConsoleApplication(IServiceProvider serviceProvider)
    {
        var stockPriceService = serviceProvider.GetRequiredService<IAlphaVantageApiService>();
        var chartService = serviceProvider.GetRequiredService<IChartService>();

        Console.WriteLine("Enter stock symbol:");
        var stockSymbol = Console.ReadLine()?.ToUpper() ?? "AAPL";
        
        Console.WriteLine($"Fetching latest price for {stockSymbol}...");
        var price = stockPriceService.GetMostRecentPrice(stockSymbol).Result;
        Console.WriteLine($"Latest price: ${price}");
        
        Console.WriteLine($"\nFetching historical data for {stockSymbol}...");
        var days = 10;
        var timeSeries = stockPriceService.GetTimeSeries(stockSymbol, days).Result;
        
        Console.WriteLine($"\nCandlestick chart for {stockSymbol} (last {days} days):");
        var chart = chartService.RenderCandlestickChart(timeSeries);
        Console.WriteLine(chart);
    }
    
}
```
  - Dockerfile (666 bytes)
    - Content preview:
```
﻿FROM mcr.microsoft.com/dotnet/runtime:8.0 AS base
USER $APP_UID
WORKDIR /app

FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
ARG BUILD_CONFIGURATION=Release
WORKDIR /src
COPY ["StockConsole/StockConsole.csproj", "StockConsole/"]
RUN dotnet restore "StockConsole/StockConsole.csproj"
COPY . .
WORKDIR "/src/StockConsole"
RUN dotnet build "StockConsole.csproj" -c $BUILD_CONFIGURATION -o /app/build

FROM build AS publish
ARG BUILD_CONFIGURATION=Release
RUN dotnet publish "StockConsole.csproj" -c $BUILD_CONFIGURATION -o /app/publish /p:UseAppHost=false

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "StockConsole.dll"]

```
  - Program.cs (1308 bytes)
    - Content preview:
```
﻿using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Serilog;
using StockConsole.Services;

namespace StockConsole
{
    class Program
    {
        public static void Main(string[] args)
        {
            // Load environment variables first
            DotNetEnv.Env.Load();
            
            // Configure and build the host
            using IHost host = CreateHostBuilder(args).Build();
            
            // Run your console application logic
            using var scope = host.Services.CreateScope();
            var services = scope.ServiceProvider;
            Client.StartConsoleApplication(services);
        }

        public static IHostBuilder CreateHostBuilder(string[] args) =>
            Host.CreateDefaultBuilder(args)
                .UseSerilog((context, services, loggerConfiguration) => 
                {
                    loggerConfiguration.WriteTo.File("/var/logs/stockconsole.log");
                })
                .ConfigureServices((hostContext, services) =>
                {
                    services.AddHttpClient();
                    services.AddSingleton<IAlphaVantageApiService, AlphaVantageApiService>();
                    services.AddSingleton<IChartService, ChartService>();
                });
    }
}
```
  - StockConsole.csproj (1256 bytes)
    - Content preview:
```
<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <OutputType>Exe</OutputType>
        <TargetFramework>net8.0</TargetFramework>
        <ImplicitUsings>enable</ImplicitUsings>
        <Nullable>enable</Nullable>
        <DockerDefaultTargetOS>Linux</DockerDefaultTargetOS>
    </PropertyGroup>

    <ItemGroup>
      <PackageReference Include="DotNetEnv" Version="3.1.1" />
      <PackageReference Include="Microsoft.Extensions.Configuration" Version="9.0.4" />
      <PackageReference Include="Microsoft.Extensions.Configuration.EnvironmentVariables" Version="9.0.4" />
      <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="9.0.4" />
      <PackageReference Include="Microsoft.Extensions.Http" Version="9.0.4" />
      <PackageReference Include="Moq" Version="4.20.72" />
      <PackageReference Include="Serilog.AspNetCore" Version="9.0.0" />
      <PackageReference Include="Serilog.Sinks.File" Version="6.0.0" />
    </ItemGroup>

    <ItemGroup>
      <None Update=".env">
        <CopyToOutputDirectory>Always</CopyToOutputDirectory>
      </None>
    </ItemGroup>

    <ItemGroup>
      <Content Include="..\.dockerignore">
        <Link>.dockerignore</Link>
      </Content>
    </ItemGroup>

</Project>

```
- **TestStockConsole/**
  - **ServicesTest/**
    - AlphaVantageApiServiceTest.cs (8163 bytes)
      - Content preview:
```
using JetBrains.Annotations;
using Microsoft.Extensions.Configuration;
using StockConsole.Model;
using StockConsole.Services;
using TestStockConsole.TestData;

namespace TestStockConsole.ServicesTest;


[TestClass]
[TestSubject(typeof(IAlphaVantageApiService))]
public class AlphaVantageApiServiceTest
{

    private static readonly Dictionary<string, string> ConfigurationValues = new Dictionary<string, string>
    {
        {"ALPHA_API_KEY", "test-api-key"},
        {"ALPHA_API_URL", "https://www.alphavantage.co/query?function={function}&symbol={symbol}&apikey={apiKey}"}
    };
    private static readonly IConfiguration Configuration = new ConfigurationBuilder()
        .AddInMemoryCollection(ConfigurationValues!)
        .Build();
    
    private IHttpClientFactory CreateMockHttpClientFactory()
    {
        return HttpClientFactoryMock.CreateMockFactory(request =>
        {
            var requestUri = request.RequestUri?.ToString() ?? string.Empty;
            if (requestUri.Contains("function=GLOBAL_QUOTE"))
            {
                return ApiData.ValidQuoteJson;
            }
            else if (requestUri.Contains("function=TIME_SERIES_DAILY"))
            {
                return ApiData.ValidTimeSeriesJson;
            }
            return "{}";
        });
    }

    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    public async Task GetMostRecentPrice_ReturnsCorrectPrice()
    {
        var mockFactory = CreateMockHttpClientFactory();
        var service = new AlphaVantageApiService(mockFactory, Configuration);
        var price = await service.GetMostRecentPrice("AAPL");
        Assert.AreEqual(221.53m, price);
    }

    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    public async Task GetMostRecentPrice_CheckSentRequest()
    {
        var mockFactory = CreateMockHttpClientFactory();
        var service = new AlphaVantageApiService(mockFactory, Configuration);
        await service.GetMostRecentPrice("AAPL");
        
        var request = HttpClientFactoryMock.ReceivedRequests[0];

        Assert.IsTrue(HttpClientFactoryMock.ReceivedRequests.Count > 0, "No requests were captured");
        Assert.IsTrue(request.RequestUri != null && request.RequestUri.ToString().Contains("AAPL"), "Request URL should contain the symbol");
        Assert.IsTrue(request.RequestUri != null && request.RequestUri.ToString().Contains("GLOBAL_QUOTE"), "Request URL should contain the function GLOBAL_QUOTE");
    }
    

    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    public async Task GetLastWeekPrices_CheckSentRequest()
    {
        var mockFactory = CreateMockHttpClientFactory();
        var service = new AlphaVantageApiService(mockFactory, Configuration);
        await service.GetTimeSeries("AAPL",7);
        
        var request = HttpClientFactoryMock.ReceivedRequests[0];

        Assert.IsTrue(HttpClientFactoryMock.ReceivedRequests.Count > 0, "No requests were captured");
        Assert.IsTrue(request.RequestUri != null && request.RequestUri.ToString().Contains("AAPL"), "Request URL should contain the symbol");
        Assert.IsTrue(request.RequestUri != null && request.RequestUri.ToString().Contains("TIME_SERIES_DAILY"), "Request URL should contain the function TIME_SERIES_DAILY");
    }

    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    [ExpectedException(typeof(ArgumentException), "Api Key not found")]
    public void Constructor_ThrowsException_WhenApiKeyMissing()
    {
        var emptyConfig = new ConfigurationBuilder()
            .AddInMemoryCollection(new Dictionary<string, string>
            {
                {"ALPHA_API_URL", "https://www.alphavantage.co/query?function={function}&symbol={symbol}&apikey={apiKey}"}
            }!)
            .Build();
            
        _ = new AlphaVantageApiService(CreateMockHttpClientFactory(), emptyConfig);
    }
    
    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    [ExpectedException(typeof(ArgumentException), "Api url not found")]
    public void Constructor_ThrowsException_WhenApiUrlMissing()
    {
        var emptyConfig = new ConfigurationBuilder()
            .AddInMemoryCollection(new Dictionary<string, string>
            {
                {"ALPHA_API_KEY", "test-api-key"}
            }!)
            .Build();
            
        _ = new AlphaVantageApiService(CreateMockHttpClientFactory(), emptyConfig);
    }

    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    [ExpectedException(typeof(ArgumentException), "Api Key not found")]
    public void Constructor_ThrowsException_WhenNoConfigValuesProvided()
    {
        var emptyConfig = new ConfigurationBuilder()
            .AddInMemoryCollection(new Dictionary<string, string>()!)
            .Build();
            
        _ = new AlphaVantageApiService(CreateMockHttpClientFactory(), emptyConfig);
    }

    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    public async Task GetTimeSeriesAllPrices_CheckSentRequest()
    {
        var mockFactory = CreateMockHttpClientFactory();
        var service = new AlphaVantageApiService(mockFactory, Configuration);
        await service.GetTimeSeries("AAPL", 3);
        
        var request = HttpClientFactoryMock.ReceivedRequests[0];

        Assert.IsTrue(HttpClientFactoryMock.ReceivedRequests.Count > 0, "No requests were captured");
        Assert.IsTrue(request.RequestUri != null && request.RequestUri.ToString().Contains("AAPL"), "Request URL should contain the symbol");
        Assert.IsTrue(request.RequestUri != null && request.RequestUri.ToString().Contains("TIME_SERIES_DAILY"), "Request URL should contain the function TIME_SERIES_DAILY");
    }
    
    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    public async Task GetTimeSeries_ReturnsDataWithCorrectStructureAndValues()
    {
        var mockFactory = CreateMockHttpClientFactory();
        var service = new AlphaVantageApiService(mockFactory, Configuration);
        
        var stockData = await service.GetTimeSeries("AAPL", 3);
        
        Assert.IsNotNull(stockData, "GetTimeSeries should not return null");
        Assert.AreEqual(3, stockData.Count, "Should return exactly 3 days of data");
        
        // Day 1 (2025-03-26)
        Assert.AreEqual(223.51m, stockData[0].Open, "Day 1 Open price should match");
        Assert.AreEqual(225.02m, stockData[0].High, "Day 1 High price should match");
        Assert.AreEqual(220.47m, stockData[0].Low, "Day 1 Low price should match");
        Assert.AreEqual(221.53m, stockData[0].Close, "Day 1 Close price should match");
        
        // Day 2 (2025-03-25)
        Assert.AreEqual(220.77m, stockData[1].Open, "Day 2 Open price should match");
        Assert.AreEqual(224.10m, stockData[1].High, "Day 2 High price should match");
        Assert.AreEqual(220.08m, stockData[1].Low, "Day 2 Low price should match");
        Assert.AreEqual(223.75m, stockData[1].Close, "Day 2 Close price should match");
        
        // Day 3 (2025-03-24)
        Assert.AreEqual(221.00m, stockData[2].Open, "Day 3 Open price should match");
        Assert.AreEqual(221.48m, stockData[2].High, "Day 3 High price should match");
        Assert.AreEqual(218.58m, stockData[2].Low, "Day 3 Low price should match");
        Assert.AreEqual(220.73m, stockData[2].Close, "Day 3 Close price should match");
        
        // Verify data type structure
        var firstDay = stockData[0];
        Assert.IsTrue(firstDay.GetType() == typeof(DailyPriceData), "Result should be of type DailyPriceData");
        Assert.IsTrue(firstDay.GetType().GetProperties().Length == 4, "DailyPriceData should have exactly 4 properties");
        Assert.IsTrue(firstDay.GetType().GetProperty("Open") != null, "DailyPriceData should have Open property");
        Assert.IsTrue(firstDay.GetType().GetProperty("High") != null, "DailyPriceData should have High property");
        Assert.IsTrue(firstDay.GetType().GetProperty("Low") != null, "DailyPriceData should have Low property");
        Assert.IsTrue(firstDay.GetType().GetProperty("Close") != null, "DailyPriceData should have Close property");
    }
}
```
    - chart.txt (657 bytes)
      - Content preview:
```
Candlestick Chart (Last 7 days)
-----------------------------
225.97 │
225.97 │              
225.21 ││             
224.45 ││ │           
223.69 │░ █           
222.93 │░ █           
222.16 │░ █   │       
221.40 │░ █ │ █       
220.64 ││ █ ░ █ │     
219.88 │  │ │ █ █     
219.12 │    │ │ █ │   
218.36 │    │   █ █ │ 
217.59 │        │ █ █ 
216.83 │          █ █ 
216.07 │            █ 
215.31 │            │ 
214.55 │──────────────
       1 2 3 4 5 6 7 

Legend: █ Up day   ░ Down day   │ Price range/wick

```
    - ChartServiceTest.cs (629 bytes)
      - Content preview:
```
using JetBrains.Annotations;
using StockConsole.Services;
using StockConsole.Utility;
using TestStockConsole.TestData;

namespace TestStockConsole.ServicesTest;

[TestClass]
[TestSubject(typeof(ChartService))]
public class ChartServiceTest
{

    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    public void CreateChart()
    {
        var service = new ChartService();
        var priceData = JsonUtility.ExtractAllPricesLastXDays(ApiData.ValidTimeSeriesJson, 7);
        var result = service.RenderCandlestickChart(priceData);
        Assert.AreEqual(File.ReadAllText("ServicesTest/chart.txt"),result);
    }
    
}
```
  - **TestData/**
    - APIData.cs (3117 bytes)
      - Content preview:
```
namespace TestStockConsole.TestData;

public class ApiData
{
    
    public const string ValidQuoteJson = @"{
            ""Global Quote"": {
                ""01. symbol"": ""AAPL"",
                ""02. open"": ""223.5100"",
                ""03. high"": ""225.0200"",
                ""04. low"": ""220.4700"",
                ""05. price"": ""221.5300"",
                ""06. volume"": ""34532656"",
                ""07. latest trading day"": ""2025-03-26"",
                ""08. previous close"": ""223.7500"",
                ""09. change"": ""-2.2200"",
                ""10. change percent"": ""-0.9922%""
            }
        }";
    
    public const string ValidTimeSeriesJson = @"{
            ""Meta Data"": {
                ""1. Information"": ""Daily Prices (open, high, low, close) and Volumes"",
                ""2. Symbol"": ""AAPL"",
                ""3. Last Refreshed"": ""2025-03-26"",
                ""4. Output Size"": ""Compact"",
                ""5. Time Zone"": ""US/Eastern""
            },
            ""Time Series (Daily)"": {
                ""2025-03-26"": {
                    ""1. open"": ""223.5100"",
                    ""2. high"": ""225.0200"",
                    ""3. low"": ""220.4700"",
                    ""4. close"": ""221.5300"",
                    ""5. volume"": ""34532656""
                },
                ""2025-03-25"": {
                    ""1. open"": ""220.7700"",
                    ""2. high"": ""224.1000"",
                    ""3. low"": ""220.0800"",
                    ""4. close"": ""223.7500"",
                    ""5. volume"": ""34493583""
                },
                ""2025-03-24"": {
                    ""1. open"": ""221.0000"",
                    ""2. high"": ""221.4800"",
                    ""3. low"": ""218.5800"",
                    ""4. close"": ""220.7300"",
                    ""5. volume"": ""44299483""
                },
                ""2025-03-23"": {
                    ""1. open"": ""219.5000"",
                    ""2. high"": ""222.1200"",
                    ""3. low"": ""219.1500"",
                    ""4. close"": ""221.0800"",
                    ""5. volume"": ""38765432""
                },
                ""2025-03-22"": {
                    ""1. open"": ""218.2500"",
                    ""2. high"": ""220.5000"",
                    ""3. low"": ""217.8800"",
                    ""4. close"": ""219.5700"",
                    ""5. volume"": ""35678923""
                },
                ""2025-03-21"": {
                    ""1. open"": ""217.1000"",
                    ""2. high"": ""219.2500"",
                    ""3. low"": ""216.7500"",
                    ""4. close"": ""218.3100"",
                    ""5. volume"": ""36543210""
                },
                ""2025-03-20"": {
                    ""1. open"": ""215.8000"",
                    ""2. high"": ""218.1000"",
                    ""3. low"": ""215.5000"",
                    ""4. close"": ""217.2500"",
                    ""5. volume"": ""37654320""
                }
            }
        }";
}
```
  - ClientTest.cs (2313 bytes)
    - Content preview:
```
using JetBrains.Annotations;
using Microsoft.Extensions.DependencyInjection;
using Moq;
using StockConsole;
using StockConsole.Model;
using StockConsole.Services;

namespace TestStockConsole;

[TestClass]
[TestSubject(typeof(Client))]
public class ClientTest
{
    private Mock<IAlphaVantageApiService>? _mockStockPriceService;
    private Mock<IChartService>? _mockChartService;
    private ServiceProvider? _serviceProvider;

    [TestInitialize]
    public void Setup()
    {
        _mockStockPriceService = new Mock<IAlphaVantageApiService>();
        _mockChartService = new Mock<IChartService>();

        var services = new ServiceCollection();
        services.AddSingleton(_mockStockPriceService.Object);
        services.AddSingleton(_mockChartService.Object);
        _serviceProvider = services.BuildServiceProvider();
    }

    [TestMethod]
    [TestCategory("ContinuousIntegration")]
    public void StartConsoleApplication_WithValidInput_DisplaysCorrectOutput()
    {
        const string testSymbol = "AAPL";
        const decimal testPrice = 150.25m;
        const int testDays = 10;
        var testTimeSeries = new List<DailyPriceData>
        {
            new() { Open = 150m, High = 151m, Low = 149m, Close = 150.25m }
        };
        const string testChart = "Test Chart";

        _mockStockPriceService!.Setup(s => s.GetMostRecentPrice(testSymbol))
            .ReturnsAsync(testPrice);
        _mockStockPriceService.Setup(s => s.GetTimeSeries(testSymbol, testDays))
            .ReturnsAsync(testTimeSeries);
        _mockChartService!.Setup(s => s.RenderCandlestickChart(testTimeSeries))
            .Returns(testChart);

        using var stringWriter = new StringWriter();
        Console.SetOut(stringWriter);
        Console.SetIn(new StringReader(testSymbol));

        Client.StartConsoleApplication(_serviceProvider!);

        var output = stringWriter.ToString();
        Assert.IsTrue(output.Contains($"Fetching latest price for {testSymbol}..."));
        Assert.IsTrue(output.Contains($"Latest price: ${testPrice}"));
        Assert.IsTrue(output.Contains($"Fetching historical data for {testSymbol}..."));
        Assert.IsTrue(output.Contains($"Candlestick chart for {testSymbol} (last {testDays} days):"));
        Assert.IsTrue(output.Contains(testChart));
    }
}
```
  - EnvironmentTest.cs (1591 bytes)
    - Content preview:
```
using Microsoft.Extensions.Configuration;
using StockConsole;

namespace TestStockConsole;

[TestClass]
public class EnvironmentTest
{
    private static readonly Dictionary<string, string> ConfigurationValues = new Dictionary<string, string>
    {
        {"ALPHA_API_KEY", "test-api-key"},
        {"ALPHA_API_URL", "https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol={symbol}&apikey={_apiKey}"}
    };
    
    private static readonly IConfiguration Configuration = new ConfigurationBuilder()
        .AddInMemoryCollection(ConfigurationValues!)
        .Build();
    
    [TestCategory("ContinuousIntegration")]
    [TestMethod]
    public void TestEnvVariablesd()
    {
        var apiKey = Configuration["ALPHA_API_KEY"] ?? throw new ArgumentException("Api Key not found");
        var apiUrl = Configuration["ALPHA_API_URL"] ?? throw new ArgumentException("Api url not found");
        Assert.IsNotNull(apiKey, apiUrl);
    }
    
    [TestCategory("Manual")]
    [TestMethod]
    public async Task FetchApi()
    {
        var apiKey = Configuration["ALPHA_API_KEY"] ?? throw new ArgumentException("Api Key not found");
        
        using var client = new HttpClient();
        string url = $"https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=AAPL&apikey={apiKey}";
        var response = await client.GetAsync(url);
    
        var content = await response.Content.ReadAsStringAsync();
    
        Console.WriteLine($"API Response: {content}");
        Assert.IsTrue(content.Contains("Global Quote"), "Response doesn't contain expected data");
    }
}
```
  - HttpClientFactoryMock.cs (2310 bytes)
    - Content preview:
```
using Moq;
using Moq.Protected;
using System.Net;

namespace TestStockConsole
{
    public static class HttpClientFactoryMock
    {
        public static List<HttpRequestMessage> ReceivedRequests { get; } = new List<HttpRequestMessage>();
        
        public static IHttpClientFactory CreateMockFactory(string jsonResponse)
        {
            return CreateMockFactory(request => jsonResponse);
        }

        public static IHttpClientFactory CreateMockFactory(Func<HttpRequestMessage, string> responseProvider)
        {
            ReceivedRequests.Clear();
            
            var handlerMock = new Mock<HttpMessageHandler>();
            
            handlerMock
                .Protected()
                .Setup<Task<HttpResponseMessage>>(
                    "SendAsync",
                    ItExpr.IsAny<HttpRequestMessage>(),
                    ItExpr.IsAny<CancellationToken>())
                .Callback<HttpRequestMessage, CancellationToken>((request, _) => 
                {
                    ReceivedRequests.Add(request);
                    
                    Console.WriteLine($"Request received: {request.Method} {request.RequestUri}");
                    
                    if (request.Content != null)
                    {
                        var content = request.Content.ReadAsStringAsync().GetAwaiter().GetResult();
                        Console.WriteLine($"Request content: {content}");
                    }
                    
                    foreach (var header in request.Headers)
                    {
                        Console.WriteLine($"Header: {header.Key} = {string.Join(", ", header.Value)}");
                    }
                })
                .ReturnsAsync((HttpRequestMessage request, CancellationToken _) => new HttpResponseMessage
                {
                    StatusCode = HttpStatusCode.OK,
                    Content = new StringContent(responseProvider(request))
                });

            var httpClient = new HttpClient(handlerMock.Object);

            var factoryMock = new Mock<IHttpClientFactory>();
            
            factoryMock
                .Setup(f => f.CreateClient(It.IsAny<string>()))
                .Returns(httpClient);

            return factoryMock.Object;
        }
    }
}
```
  - JsonUtilityTest.cs (4969 bytes)
    - Content preview:
```
using JetBrains.Annotations;
using System.Text.Json;
using StockConsole.Utility;

namespace TestStockConsole;

[TestClass]
[TestSubject(typeof(JsonUtility))]
public class JsonUtilityTest
{
    [TestCategory("ContinuousIntegration")]
    [TestMethod]
    public void ExtractMostRecentPrice_ValidJson_ReturnsPrice()
    {
        string validJson = @"{
            ""Global Quote"": {
                ""01. symbol"": ""AAPL"",
                ""02. open"": ""223.5100"",
                ""03. high"": ""225.0200"",
                ""04. low"": ""220.4700"",
                ""05. price"": ""221.5300"",
                ""06. volume"": ""34532656"",
                ""07. latest trading day"": ""2025-03-26"",
                ""08. previous close"": ""223.7500"",
                ""09. change"": ""-2.2200"",
                ""10. change percent"": ""-0.9922%""
            }
        }";
        
        decimal price = JsonUtility.ExtractLatestPrice(validJson);
        
        Assert.AreEqual(221.53m, price);
    }
    
    [TestCategory("ContinuousIntegration")]
    [TestMethod]
    [ExpectedException(typeof(JsonException), "Global Quote property not found in API response")]
    public void ExtractMostRecentPrice_MissingGlobalQuote_ThrowsJsonException()
    {
        string invalidJson = @"{
            ""WrongProperty"": {}
        }";
        JsonUtility.ExtractLatestPrice(invalidJson);
    }
    
    [TestCategory("ContinuousIntegration")]
    [TestMethod]
    [ExpectedException(typeof(JsonException), "Price property not found in API response")]
    public void ExtractMostRecentPrice_MissingPriceProperty_ThrowsJsonException()
    {
        string invalidJson = @"{
            ""Global Quote"": {
                ""01. symbol"": ""AAPL"",
                ""02. open"": ""223.5100"",
                ""missing price property"": ""value""
            }
        }";
        JsonUtility.ExtractLatestPrice(invalidJson);
    }
    
    [TestCategory("ContinuousIntegration")]
    [TestMethod]
    public void ExtractAllPricesLastXDays_ValidJson_ReturnsCorrectPrices()
    {
        string validJson = @"{
            ""Meta Data"": {
                ""1. Information"": ""Daily Prices (open, high, low, close) and Volumes"",
                ""2. Symbol"": ""AAPL"",
                ""3. Last Refreshed"": ""2025-03-26"",
                ""4. Output Size"": ""Compact"",
                ""5. Time Zone"": ""US/Eastern""
            },
            ""Time Series (Daily)"": {
                ""2025-03-26"": {
                    ""1. open"": ""223.5100"",
                    ""2. high"": ""225.0200"",
                    ""3. low"": ""220.4700"",
                    ""4. close"": ""221.5300"",
                    ""5. volume"": ""34532656""
                },
                ""2025-03-25"": {
                    ""1. open"": ""220.7700"",
                    ""2. high"": ""224.1000"",
                    ""3. low"": ""220.0800"",
                    ""4. close"": ""223.7500"",
                    ""5. volume"": ""34493583""
                },
                ""2025-03-24"": {
                    ""1. open"": ""221.0000"",
                    ""2. high"": ""221.4800"",
                    ""3. low"": ""218.5800"",
                    ""4. close"": ""220.7300"",
                    ""5. volume"": ""44299483""
                }
            }
        }";
        
        var priceDataList = JsonUtility.ExtractAllPricesLastXDays(validJson, 3);
        
        Assert.AreEqual(3, priceDataList.Count);
        
        // Check first day's values
        Assert.AreEqual(223.51m, priceDataList[0].Open);
        Assert.AreEqual(225.02m, priceDataList[0].High);
        Assert.AreEqual(220.47m, priceDataList[0].Low);
        Assert.AreEqual(221.53m, priceDataList[0].Close);
        
        // Check second day's values
        Assert.AreEqual(220.77m, priceDataList[1].Open);
        Assert.AreEqual(224.10m, priceDataList[1].High);
        Assert.AreEqual(220.08m, priceDataList[1].Low);
        Assert.AreEqual(223.75m, priceDataList[1].Close);
        
        // Check third day's values
        Assert.AreEqual(221.00m, priceDataList[2].Open);
        Assert.AreEqual(221.48m, priceDataList[2].High);
        Assert.AreEqual(218.58m, priceDataList[2].Low);
        Assert.AreEqual(220.73m, priceDataList[2].Close);
    }
    
    [TestCategory("ContinuousIntegration")]
    [TestMethod]
    [ExpectedException(typeof(System.InvalidOperationException))]
    public void ExtractAllPricesLastXDays_MissingTimeSeriesProperty_ThrowsJsonException()
    {
        string invalidJson = @"{
            ""Meta Data"": {
                ""1. Information"": ""Daily Prices (open, high, low, close) and Volumes"",
                ""2. Symbol"": ""AAPL"",
                ""3. Last Refreshed"": ""2025-03-26""
            },
            ""Wrong Property"": {}
        }";
        
        JsonUtility.ExtractAllPricesLastXDays(invalidJson, 3);
    }
}
```
  - TestStockConsole.csproj (1588 bytes)
    - Content preview:
```
<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <TargetFramework>net8.0</TargetFramework>
        <ImplicitUsings>enable</ImplicitUsings>
        <Nullable>enable</Nullable>

        <IsPackable>false</IsPackable>
        <IsTestProject>true</IsTestProject>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="coverlet.collector" Version="6.0.4">
          <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
          <PrivateAssets>all</PrivateAssets>
        </PackageReference>
        <PackageReference Include="coverlet.msbuild" Version="6.0.4">
          <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
          <PrivateAssets>all</PrivateAssets>
        </PackageReference>
        <PackageReference Include="DotNetEnv" Version="3.1.1" />
        <PackageReference Include="JetBrains.Annotations" Version="2025.1.0-eap1" />
        <PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.8.0" />
        <PackageReference Include="MSTest.TestAdapter" Version="3.1.1" />
        <PackageReference Include="MSTest.TestFramework" Version="3.1.1" />
    </ItemGroup>

    <ItemGroup>
        <Using Include="Microsoft.VisualStudio.TestTools.UnitTesting" />
    </ItemGroup>

    <ItemGroup>
      <ProjectReference Include="..\StockConsole\StockConsole.csproj" />
    </ItemGroup>

    <ItemGroup>
      <None Update="ServicesTest\chart.txt">
        <CopyToOutputDirectory>Always</CopyToOutputDirectory>
      </None>
    </ItemGroup>

</Project>

```
- .dockerignore (314 bytes)
  - Content preview:
```
﻿**/.dockerignore
**/.env
**/.git
**/.gitignore
**/.project
**/.settings
**/.toolstarget
**/.vs
**/.vscode
**/.idea
**/*.*proj.user
**/*.dbmdl
**/*.jfm
**/azds.yaml
**/bin
**/charts
**/docker-compose*
**/Dockerfile*
**/node_modules
**/npm-debug.log
**/obj
**/secrets.dev.yaml
**/values.dev.yaml
LICENSE
README.md
```
- ¨ (721 bytes)
  - Content preview:
```
refactor project structure
# Please enter the commit message for your changes. Lines starting
# with '#' will be ignored, and an empty message aborts the commit.
#
# On branch main
# Your branch is up to date with 'origin/main'.
#
# Changes to be committed:
#	renamed:    StockConsole/AlphaVantageApiService.cs -> StockConsole/Services/AlphaVantageApiService.cs
#	renamed:    StockConsole/ChartService.cs -> StockConsole/Services/ChartService.cs
#	renamed:    StockConsole/IAlphaVantageApiService.cs -> StockConsole/Services/IAlphaVantageApiService.cs
#	renamed:    StockConsole/IChartService.cs -> StockConsole/Services/IChartService.cs
#	renamed:    StockConsole/JsonUtility.cs -> StockConsole/Utility/JsonUtility.cs
#

```
- compose.yaml (423 bytes)
  - Content preview:
```
﻿version: '3.7'

services:
  loki:
    image: grafana/loki:latest
    ports:
      - "3100:3100"
    command: -config.file=/etc/loki/local-config.yaml

  promtail:
    image: grafana/promtail:latest
    volumes:
      - /var/log:/var/log
      - ./promtail-config.yml:/etc/promtail/config.yml
    command: -config.file=/etc/promtail/config.yml

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"

```
- promtail-config.yml (323 bytes)
  - Content preview:
```
server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  - job_name: system
    static_configs:
      - targets:
          - localhost
        labels:
          job: varlogs
          __path__: /var/log/*.log

```
- README.md (1671 bytes)
  - Content preview:
```
# Swat Project
[![Build Pipeline](https://github.com/ostaubzug/SwatStockConsole/actions/workflows/buildpipeline.yml/badge.svg)](https://github.com/ostaubzug/SwatStockConsole/actions/workflows/buildpipeline.yml)
[![Code Coverage Pipeline](https://github.com/ostaubzug/SwatStockConsole/actions/workflows/codecoverage.yml/badge.svg)](https://github.com/ostaubzug/SwatStockConsole/actions/workflows/codecoverage.yml)
[![Code Coverage](https://img.shields.io/endpoint?url=https://gist.githubusercontent.com/ostaubzug/d3cd25b634cc40dd9ebd104ce7fffce7/raw/code-coverage.json)](https://github.com/ostaubzug/SwatStockConsole/actions/workflows/codecoverage.yml)
[![SonarCloud](https://sonarcloud.io/api/project_badges/measure?project=ostaubzug_SwatStockConsole&metric=alert_status)](https://sonarcloud.io/project/overview?id=ostaubzug_SwatStockConsole)
[![Dependabot](https://img.shields.io/badge/dependabot-enabled-025e8c?logo=dependabot)](https://docs.github.com/code-security/dependabot/dependabot-version-updates)
## Setup
In the StockConsole Project create a .env File with this content:

` ` `
ALPHA_API_KEY=your-alpha-vantage-key
ALPHA_API_URL=https://www.alphavantage.co/query?function={function}&symbol={symbol}&apikey={apiKey}
` ` `

You can get your API Key here: https://www.alphavantage.co/support/#api-key

Make sure the file is getting copied to the output directory.

## Git
Wir nutzen den main und develop branch.

## Pipelines

### Build Pipeline
The build Pipeline generates a summary about the tests that have been run.
![TestSummary](Images/TestSummary.png)

### Code Coverage Pipeline
The code coverage Pipeline generates a detailed report that can be downloaded.
```
- SwatStockConsole.sln (1564 bytes)
  - Content preview:
```
﻿
Microsoft Visual Studio Solution File, Format Version 12.00
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "StockConsole", "StockConsole\StockConsole.csproj", "{041D0B58-9D47-4D21-8756-5BDEAA826BC8}"
EndProject
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "TestStockConsole", "TestStockConsole\TestStockConsole.csproj", "{A54DEE02-BD45-4F45-93D9-F3AED8E29413}"
EndProject
Project("{2150E333-8FDC-42A3-9474-1A3956D46DE8}") = "Solution Items", "Solution Items", "{BDFB508A-7E30-4CF5-AE82-DBDE60802AFB}"
	ProjectSection(SolutionItems) = preProject
		compose.yaml = compose.yaml
		promtail-config.yml = promtail-config.yml
	EndProjectSection
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{041D0B58-9D47-4D21-8756-5BDEAA826BC8}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{041D0B58-9D47-4D21-8756-5BDEAA826BC8}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{041D0B58-9D47-4D21-8756-5BDEAA826BC8}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{041D0B58-9D47-4D21-8756-5BDEAA826BC8}.Release|Any CPU.Build.0 = Release|Any CPU
		{A54DEE02-BD45-4F45-93D9-F3AED8E29413}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{A54DEE02-BD45-4F45-93D9-F3AED8E29413}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{A54DEE02-BD45-4F45-93D9-F3AED8E29413}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{A54DEE02-BD45-4F45-93D9-F3AED8E29413}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
EndGlobal

```
